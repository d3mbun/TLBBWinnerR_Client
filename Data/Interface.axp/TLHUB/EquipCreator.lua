EquipCreator_Index = -1;
EquipCreator_Type = -1;
EquipCreator_List = -1;
EquipCreator_Selection = -1;

EquipCreator_Group = 0;
EquipCreator_EquipList = {};

EquipCreator_Equip1List = {
	{10000000,0,"Ðao Búa",10200018},
		{10200011,1,20103001,25,20103061,10,20103097,12,20308001,1},
		{10200012,1,20103002,30,20103062,15,20103097,15,20308002,1},
		{10200013,1,20103003,35,20103063,20,20103097,21,20308003,1},
		{10200014,1,20103004,40,20103064,25,20103098,24,20308004,1},
		{10200015,1,20103005,45,20103065,30,20103098,27,20308005,1},
		{10200016,1,20103006,50,20103066,35,20103098,33,20308006,1},
		{10200017,1,20103007,55,20103067,40,20103099,48,20308007,1},
		{10200018,1,20103008,60,20103068,45,20103099,52,20308008,1},
		{10200019,1,20103009,65,20103069,50,20103099,60,20308009,1},
		{10200020,1,20103010,70,20103070,55,20103099,64,20308010,1},

	{10001000,0,"Thß½ng T¥n",10201018},
		{10201011,1,20103001,25,20103061,10,20103097,12,20308011,1},
		{10201012,1,20103002,30,20103062,15,20103097,15,20308012,1},
		{10201013,1,20103003,35,20103063,20,20103097,21,20308013,1},
		{10201014,1,20103004,40,20103064,25,20103098,24,20308014,1},
		{10201015,1,20103005,45,20103065,30,20103098,27,20308015,1},
		{10201016,1,20103006,50,20103066,35,20103098,33,20308016,1},
		{10201017,1,20103007,55,20103067,40,20103099,48,20308017,1},
		{10201018,1,20103008,60,20103068,45,20103099,52,20308018,1},
		{10201019,1,20103009,65,20103069,50,20103099,60,20308019,1},
		{10201020,1,20103010,70,20103070,55,20103099,64,20308020,1},

	{10002000,0,"Ð½n Ðoän",10202018},
		{10202011,1,20103001,25,20103061,10,20103097,12,20308021,1},
		{10202012,1,20103002,30,20103062,15,20103097,15,20308022,1},
		{10202013,1,20103003,35,20103063,20,20103097,21,20308023,1},
		{10202014,1,20103004,40,20103064,25,20103098,24,20308024,1},
		{10202015,1,20103005,45,20103065,30,20103098,27,20308025,1},
		{10202016,1,20103006,50,20103066,35,20103098,33,20308026,1},
		{10202017,1,20103007,55,20103067,40,20103099,48,20308027,1},
		{10202018,1,20103008,60,20103068,45,20103099,52,20308028,1},
		{10202019,1,20103009,65,20103069,50,20103099,60,20308029,1},
		{10202020,1,20103010,70,20103070,55,20103099,64,20308030,1},

	{10003000,0,"Song Ðoän",10203018},
		{10203011,1,20103001,25,20103061,10,20103097,12,20308031,1},
		{10203012,1,20103002,30,20103062,15,20103097,15,20308032,1},
		{10203013,1,20103003,35,20103063,20,20103097,21,20308033,1},
		{10203014,1,20103004,40,20103064,25,20103098,24,20308034,1},
		{10203015,1,20103005,45,20103065,30,20103098,27,20308035,1},
		{10203016,1,20103006,50,20103066,35,20103098,33,20308036,1},
		{10203017,1,20103007,55,20103067,40,20103099,48,20308037,1},
		{10203018,1,20103008,60,20103068,45,20103099,52,20308038,1},
		{10203019,1,20103009,65,20103069,50,20103099,60,20308039,1},
		{10203020,1,20103010,70,20103070,55,20103099,64,20308040,1},

	{10004000,0,"Phiªn",10204018},
		{10204011,1,20103001,25,20103061,10,20103097,12,20308041,1},
		{10204012,1,20103002,30,20103062,15,20103097,15,20308042,1},
		{10204013,1,20103003,35,20103063,20,20103097,21,20308043,1},
		{10204014,1,20103004,40,20103064,25,20103098,24,20308044,1},
		{10204015,1,20103005,45,20103065,30,20103098,27,20308045,1},
		{10204016,1,20103006,50,20103066,35,20103098,33,20308046,1},
		{10204017,1,20103007,55,20103067,40,20103099,48,20308047,1},
		{10204018,1,20103008,60,20103068,45,20103099,52,20308048,1},
		{10204019,1,20103009,65,20103069,50,20103099,60,20308049,1},
		{10204020,1,20103010,70,20103070,55,20103099,64,20308050,1},

	{10005000,0,"Khuyên",10205018},
		{10205011,1,20103001,25,20103061,10,20103097,12,20308051,1},
		{10205012,1,20103002,30,20103062,15,20103097,15,20308052,1},
		{10205013,1,20103003,35,20103063,20,20103097,21,20308053,1},
		{10205014,1,20103004,40,20103064,25,20103098,24,20308054,1},
		{10205015,1,20103005,45,20103065,30,20103098,27,20308055,1},
		{10205016,1,20103006,50,20103066,35,20103098,33,20308056,1},
		{10205017,1,20103007,55,20103067,40,20103099,48,20308057,1},
		{10205018,1,20103008,60,20103068,45,20103099,52,20308058,1},
		{10205019,1,20103009,65,20103069,50,20103099,60,20308059,1},
		{10205020,1,20103010,70,20103070,55,20103099,64,20308060,1},
}

EquipCreator_Equip2List = {
	{10010000,0,"MÕo TØ",10210016},
		{10210002,2,20105001,28,20103073,12,20103100,24,20308061,1},
		{10210004,2,20105002,32,20103074,16,20103100,27,20308062,1},
		{10210006,2,20105003,36,20103075,20,20103100,33,20308063,1},
		{10210008,2,20105004,40,20103076,24,20103101,36,20308064,1},
		{10210010,2,20105005,44,20103077,28,20103101,39,20308065,1},
		{10210012,2,20105006,48,20103078,32,20103101,45,20308066,1},
		{10210014,2,20105007,52,20103079,36,20103102,64,20308067,1},
		{10210016,2,20105008,56,20103080,40,20103102,68,20308068,1},
		{10210018,2,20105009,60,20103081,44,20103102,76,20308069,1},
		{10210020,2,20105010,64,20103082,48,20103102,80,20308070,1},
		{10210022,2,20105001,28,20103073,12,20103100,24,20308061,1},
		{10210024,2,20105002,32,20103074,16,20103100,27,20308062,1},
		{10210026,2,20105003,36,20103075,20,20103100,33,20308063,1},
		{10210028,2,20105004,40,20103076,24,20103101,36,20308064,1},
		{10210030,2,20105005,44,20103077,28,20103101,39,20308065,1},
		{10210032,2,20105006,48,20103078,32,20103101,45,20308066,1},
		{10210034,2,20105007,52,20103079,36,20103102,64,20308067,1},
		{10210036,2,20105008,56,20103080,40,20103102,68,20308068,1},
		{10210038,2,20105009,60,20103081,44,20103102,76,20308069,1},
		{10210040,2,20105010,64,20103082,48,20103102,80,20308070,1},
		{10210042,2,20105001,28,20103073,12,20103100,24,20308061,1},
		{10210044,2,20105002,32,20103074,16,20103100,27,20308062,1},
		{10210046,2,20105003,36,20103075,20,20103100,33,20308063,1},
		{10210048,2,20105004,40,20103076,24,20103101,36,20308064,1},
		{10210050,2,20105005,44,20103077,28,20103101,39,20308065,1},
		{10210052,2,20105006,48,20103078,32,20103101,45,20308066,1},
		{10210054,2,20105007,52,20103079,36,20103102,64,20308067,1},
		{10210056,2,20105008,56,20103080,40,20103102,68,20308068,1},
		{10210058,2,20105009,60,20103081,44,20103102,76,20308069,1},
		{10210060,2,20105010,64,20103082,48,20103102,80,20308070,1},

	{10020000,0,"Y Phøc",10213016},
		{10213002,2,20105001,28,20103073,12,20103100,24,20308071,1},
		{10213004,2,20105002,32,20103074,16,20103100,27,20308072,1},
		{10213006,2,20105003,36,20103075,20,20103100,33,20308073,1},
		{10213008,2,20105004,40,20103076,24,20103101,36,20308074,1},
		{10213010,2,20105005,44,20103077,28,20103101,39,20308075,1},
		{10213012,2,20105006,48,20103078,32,20103101,45,20308076,1},
		{10213014,2,20105007,52,20103079,36,20103102,64,20308077,1},
		{10213016,2,20105008,56,20103080,40,20103102,68,20308078,1},
		{10213018,2,20105009,60,20103081,44,20103102,76,20308079,1},
		{10213020,2,20105010,64,20103082,48,20103102,80,20308080,1},
		{10213022,2,20105001,28,20103073,12,20103100,24,20308071,1},
		{10213024,2,20105002,32,20103074,16,20103100,27,20308072,1},
		{10213026,2,20105003,36,20103075,20,20103100,33,20308073,1},
		{10213028,2,20105004,40,20103076,24,20103101,36,20308074,1},
		{10213030,2,20105005,44,20103077,28,20103101,39,20308075,1},
		{10213032,2,20105006,48,20103078,32,20103101,45,20308076,1},
		{10213034,2,20105007,52,20103079,36,20103102,64,20308077,1},
		{10213036,2,20105008,56,20103080,40,20103102,68,20308078,1},
		{10213038,2,20105009,60,20103081,44,20103102,76,20308079,1},
		{10213040,2,20105010,64,20103082,48,20103102,80,20308080,1},
		{10213042,2,20105001,28,20103073,12,20103100,24,20308071,1},
		{10213044,2,20105002,32,20103074,16,20103100,27,20308072,1},
		{10213046,2,20105003,36,20103075,20,20103100,33,20308073,1},
		{10213048,2,20105004,40,20103076,24,20103101,36,20308074,1},
		{10213050,2,20105005,44,20103077,28,20103101,39,20308075,1},
		{10213052,2,20105006,48,20103078,32,20103101,45,20308076,1},
		{10213054,2,20105007,52,20103079,36,20103102,64,20308077,1},
		{10213056,2,20105008,56,20103080,40,20103102,68,20308078,1},
		{10213058,2,20105009,60,20103081,44,20103102,76,20308079,1},
		{10213060,2,20105010,64,20103082,48,20103102,80,20308080,1},

	{10030000,0,"Hµ Thü",10212016},
		{10212002,2,20105001,28,20103073,12,20103100,24,20308081,1},
		{10212004,2,20105002,32,20103074,16,20103100,27,20308082,1},
		{10212006,2,20105003,36,20103075,20,20103100,33,20308083,1},
		{10212008,2,20105004,40,20103076,24,20103101,36,20308084,1},
		{10212010,2,20105005,44,20103077,28,20103101,39,20308085,1},
		{10212012,2,20105006,48,20103078,32,20103101,45,20308086,1},
		{10212014,2,20105007,52,20103079,36,20103102,64,20308087,1},
		{10212016,2,20105008,56,20103080,40,20103102,68,20308088,1},
		{10212018,2,20105009,60,20103081,44,20103102,76,20308089,1},
		{10212020,2,20105010,64,20103082,48,20103102,80,20308090,1},
		{10212022,2,20105001,28,20103073,12,20103100,24,20308081,1},
		{10212024,2,20105002,32,20103074,16,20103100,27,20308082,1},
		{10212026,2,20105003,36,20103075,20,20103100,33,20308083,1},
		{10212028,2,20105004,40,20103076,24,20103101,36,20308084,1},
		{10212030,2,20105005,44,20103077,28,20103101,39,20308085,1},
		{10212032,2,20105006,48,20103078,32,20103101,45,20308086,1},
		{10212034,2,20105007,52,20103079,36,20103102,64,20308087,1},
		{10212036,2,20105008,56,20103080,40,20103102,68,20308088,1},
		{10212038,2,20105009,60,20103081,44,20103102,76,20308089,1},
		{10212040,2,20105010,64,20103082,48,20103102,80,20308090,1},
		{10212042,2,20105001,28,20103073,12,20103100,24,20308081,1},
		{10212044,2,20105002,32,20103074,16,20103100,27,20308082,1},
		{10212046,2,20105003,36,20103075,20,20103100,33,20308083,1},
		{10212048,2,20105004,40,20103076,24,20103101,36,20308084,1},
		{10212050,2,20105005,44,20103077,28,20103101,39,20308085,1},
		{10212052,2,20105006,48,20103078,32,20103101,45,20308086,1},
		{10212054,2,20105007,52,20103079,36,20103102,64,20308087,1},
		{10212056,2,20105008,56,20103080,40,20103102,68,20308088,1},
		{10212058,2,20105009,60,20103081,44,20103102,76,20308089,1},
		{10212060,2,20105010,64,20103082,48,20103102,80,20308090,1},
	
	{10040000,0,"Hài TØ",10211016},
		{10211002,2,20105001,28,20103073,12,20103100,24,20308091,1},
		{10211004,2,20105002,32,20103074,16,20103100,27,20308092,1},
		{10211006,2,20105003,36,20103075,20,20103100,33,20308093,1},
		{10211008,2,20105004,40,20103076,24,20103101,36,20308094,1},
		{10211010,2,20105005,44,20103077,28,20103101,39,20308095,1},
		{10211012,2,20105006,48,20103078,32,20103101,45,20308096,1},
		{10211014,2,20105007,52,20103079,36,20103102,64,20308097,1},
		{10211016,2,20105008,56,20103080,40,20103102,68,20308098,1},
		{10211018,2,20105009,60,20103081,44,20103102,76,20308099,1},
		{10211020,2,20105010,64,20103082,48,20103102,80,20308100,1},
		{10211022,2,20105001,28,20103073,12,20103100,24,20308091,1},
		{10211024,2,20105002,32,20103074,16,20103100,27,20308092,1},
		{10211026,2,20105003,36,20103075,20,20103100,33,20308093,1},
		{10211028,2,20105004,40,20103076,24,20103101,36,20308094,1},
		{10211030,2,20105005,44,20103077,28,20103101,39,20308095,1},
		{10211032,2,20105006,48,20103078,32,20103101,45,20308096,1},
		{10211034,2,20105007,52,20103079,36,20103102,64,20308097,1},
		{10211036,2,20105008,56,20103080,40,20103102,68,20308098,1},
		{10211038,2,20105009,60,20103081,44,20103102,76,20308099,1},
		{10211040,2,20105010,64,20103082,48,20103102,80,20308100,1},
		{10211042,2,20105001,28,20103073,12,20103100,24,20308091,1},
		{10211044,2,20105002,32,20103074,16,20103100,27,20308092,1},
		{10211046,2,20105003,36,20103075,20,20103100,33,20308093,1},
		{10211048,2,20105004,40,20103076,24,20103101,36,20308094,1},
		{10211050,2,20105005,44,20103077,28,20103101,39,20308095,1},
		{10211052,2,20105006,48,20103078,32,20103101,45,20308096,1},
		{10211054,2,20105007,52,20103079,36,20103102,64,20308097,1},
		{10211056,2,20105008,56,20103080,40,20103102,68,20308098,1},
		{10211058,2,20105009,60,20103081,44,20103102,76,20308099,1},
		{10211060,2,20105010,64,20103082,48,20103102,80,20308100,1},

	{10050000,0,"Yêu Ðái",10221018},
		{10221011,2,20105001,28,20103073,12,20103100,24,20308151,1},
		{10221012,2,20105002,32,20103074,16,20103100,27,20308152,1},
		{10221013,2,20105003,36,20103075,20,20103100,33,20308153,1},
		{10221014,2,20105004,40,20103076,24,20103101,36,20308154,1},
		{10221015,2,20105005,44,20103077,28,20103101,39,20308155,1},
		{10221016,2,20105006,48,20103078,32,20103101,45,20308156,1},
		{10221017,2,20105007,52,20103079,36,20103102,64,20308157,1},
		{10221018,2,20105008,56,20103080,40,20103102,68,20308158,1},
		{10221019,2,20105009,60,20103081,44,20103102,76,20308159,1},
		{10221020,2,20105010,64,20103082,48,20103102,80,20308160,1},

	{10140000,0,"Hµ Uy¬n",10214016},
		{10214002,2,20105001,28,20103073,12,20103100,24,20308131,1},
		{10214004,2,20105002,32,20103074,16,20103100,27,20308132,1},
		{10214006,2,20105003,36,20103075,20,20103100,33,20308133,1},
		{10214008,2,20105004,40,20103076,24,20103101,36,20308134,1},
		{10214010,2,20105005,44,20103077,28,20103101,39,20308135,1},
		{10214012,2,20105006,48,20103078,32,20103101,45,20308136,1},
		{10214014,2,20105007,52,20103079,36,20103102,64,20308137,1},
		{10214016,2,20105008,56,20103080,40,20103102,68,20308138,1},
		{10214018,2,20105009,60,20103081,44,20103102,76,20308139,1},
		{10214020,2,20105010,64,20103082,48,20103102,80,20308140,1},

	{10150000,0,"Hµ Kiên",10215016},
		{10215002,2,20105001,28,20103073,12,20103100,24,20308141,1},
		{10215004,2,20105002,32,20103074,16,20103100,27,20308142,1},
		{10215006,2,20105003,36,20103075,20,20103100,33,20308143,1},
		{10215008,2,20105004,40,20103076,24,20103101,36,20308144,1},
		{10215010,2,20105005,44,20103077,28,20103101,39,20308145,1},
		{10215012,2,20105006,48,20103078,32,20103101,45,20308146,1},
		{10215014,2,20105007,52,20103079,36,20103102,64,20308147,1},
		{10215016,2,20105008,56,20103080,40,20103102,68,20308148,1},
		{10215018,2,20105009,60,20103081,44,20103102,76,20308149,1},
		{10215020,2,20105010,64,20103082,48,20103102,80,20308150,1},
}

EquipCreator_Equip3List = {
	{10070000,0,"HÕng Liên",10220018},
		{10220011,3,20103001,7,20103085,12,20308101,1,-1,-1},
		{10220012,3,20103002,14,20103086,24,20308102,1,-1,-1},
		{10220013,3,20103003,21,20103087,42,20308103,1,-1,-1},
		{10220014,3,20103004,28,20103088,54,20308104,1,-1,-1},
		{10220015,3,20103005,35,20103089,66,20308105,1,-1,-1},
		{10220016,3,20103006,42,20103090,84,20308106,1,-1,-1},
		{10220017,3,20103007,49,20103091,96,20308107,1,-1,-1},
		{10220018,3,20103008,56,20103092,108,20308108,1,-1,-1},
		{10220019,3,20103009,63,20103093,126,20308109,1,-1,-1},
		{10220020,3,20103010,69,20103094,138,20308110,1,-1,-1},

	{10060000,0,"Gi¾i Chï",10222018},
		{10222011,3,20103001,7,20103085,12,20308111,1,-1,-1},
		{10222012,3,20103002,14,20103086,24,20308112,1,-1,-1},
		{10222013,3,20103003,21,20103087,42,20308113,1,-1,-1},
		{10222014,3,20103004,28,20103088,54,20308114,1,-1,-1},
		{10222015,3,20103005,35,20103089,66,20308115,1,-1,-1},
		{10222016,3,20103006,42,20103090,84,20308116,1,-1,-1},
		{10222017,3,20103007,49,20103091,96,20308117,1,-1,-1},
		{10222018,3,20103008,56,20103092,108,20308118,1,-1,-1},
		{10222031,3,20103008,56,20103092,108,20308118,1,-1,-1},
		{10222032,3,20103008,56,20103092,108,20308118,1,-1,-1},
		{10222019,3,20103009,63,20103093,126,20308119,1,-1,-1},
		{10222033,3,20103009,63,20103093,126,20308119,1,-1,-1},
		{10222034,3,20103009,63,20103093,126,20308119,1,-1,-1},
		{10222020,3,20103010,69,20103094,138,20308120,1,-1,-1},
		{10222035,3,20103010,69,20103094,138,20308120,1,-1,-1},
		{10222036,3,20103010,69,20103094,138,20308120,1,-1,-1},
	
	{10120000,0,"Hµ Phù",10223018},
		{10223011,3,20103001,7,20103085,12,20308121,1,-1,-1},
		{10223012,3,20103002,14,20103086,24,20308122,1,-1,-1},
		{10223013,3,20103003,21,20103087,42,20308123,1,-1,-1},
		{10223014,3,20103004,28,20103088,54,20308124,1,-1,-1},
		{10223015,3,20103005,35,20103089,66,20308125,1,-1,-1},
		{10223016,3,20103006,42,20103090,84,20308126,1,-1,-1},
		{10223017,3,20103007,49,20103091,96,20308127,1,-1,-1},
		{10223018,3,20103008,56,20103092,108,20308128,1,-1,-1},
		{10223031,3,20103008,56,20103092,108,20308128,1,-1,-1},
		{10223032,3,20103008,56,20103092,108,20308128,1,-1,-1},
		{10223019,3,20103009,63,20103093,126,20308129,1,-1,-1},
		{10223033,3,20103009,63,20103093,126,20308129,1,-1,-1},
		{10223034,3,20103009,63,20103093,126,20308129,1,-1,-1},
		{10223020,3,20103010,69,20103094,138,20308130,1,-1,-1},
		{10223035,3,20103010,69,20103094,138,20308130,1,-1,-1},
		{10223036,3,20103010,69,20103094,138,20308130,1,-1,-1},
}

EquipCreator_Type = 0; --0: KNS / 1: NL

function EquipCreator_PreLoad()
	this:RegisterEvent("UI_COMMAND");
	this:RegisterEvent("PLAYER_LEAVE_WORLD");
	this:RegisterEvent("PACKAGE_ITEM_CHANGED");
	
end

function EquipCreator_OnLoad()
	--EquipCreator_AllMake:Disable();
end


function EquipCreator_ChangeMode()
	EquipCreator_OnHidden();
	if EquipCreator_Type == 1 then
		if EquipCreator_List == 1 then
			PushEvent("UI_COMMAND",1017001)
		elseif EquipCreator_List == 2 then
			PushEvent("UI_COMMAND",1017002)
		elseif EquipCreator_List == 3 then
			PushEvent("UI_COMMAND",1017003)
		end
		EquipCreator_AllMake:SetText("Nguyên Li®u")
	elseif EquipCreator_Type == 0 then
		if EquipCreator_List == 1 then
			PushEvent("UI_COMMAND",1017011)
		elseif EquipCreator_List == 2 then
			PushEvent("UI_COMMAND",1017012)
		elseif EquipCreator_List == 3 then
			PushEvent("UI_COMMAND",1017013)
		end
		EquipCreator_AllMake:SetText("T.Tr÷t/K.Khoáng")
	else
	
	end
end

function EquipCreator_OnEvent(event)
	
	if event == "UI_COMMAND" and tonumber(arg0) >= 1017001 and tonumber(arg0) <= 1017013 then
		EquipCreator_Type = tonumber(string.sub(arg0,6,6))
		EquipCreator_List = tonumber(string.sub(arg0,7,7))
		
		if EquipCreator_Type == 0 then
			EquipCreator_AllMake:SetText("Nguyên Li®u")
		else
			EquipCreator_AllMake:SetText("T.Tr÷t/K.Khoáng")
		end
		
		if EquipCreator_List == 1 then
			EquipCreator_EquipList = EquipCreator_Equip1List
		elseif EquipCreator_List == 2 then
			EquipCreator_EquipList = EquipCreator_Equip2List
		elseif EquipCreator_List == 3 then
			EquipCreator_EquipList = EquipCreator_Equip3List
		end
		
		if this:IsVisible() then
			this:Hide();
			return;
		end
		EquipCreator_Update()
		this:Show();
	end
	
	if event == "PACKAGE_ITEM_CHANGED" then
		EquipCreator_ListBox_Selected()
	end
	
	if IsWindowShow("EquipCreator") then
		if event == "UI_COMMAND" and tonumber(arg0) == 10102017 then
			EquipCreator_UpdateMaterial(tonumber(arg1))
		end
	end
	
	if event == "PLAYER_LEAVE_WORLD" then
		EquipCreator_OnHidden();
		return;
	end
end

function EquipCreator_UpdateMaterial(pos)
	
	if EquipCreator_Index ~= -1 then
		LifeAbility:Lock_Packet_Item( EquipCreator_Index, 0 )
	end

	if EquipCreator_Type == 1 then
		local Index = EnumAction(pos, "packageitem")
		local ItemID = Index:GetDefineID()
		
		if ItemID >= 20400300 and ItemID <= 20502008 then
			if math.mod(ItemID,10) == 0 then
				return
			end
		else
			return
		end
		
		EquipCreator_Index = pos
		for i = 30, 59 do
			local IndexCheck = EnumAction(i, "packageitem")
			local ItemIDCheck = IndexCheck:GetDefineID()
			if ItemIDCheck == ItemID then
				Index = EnumAction(i, "packageitem")
				EquipCreator_Index = i
				break
			end
		end
		
		EquipCreator_SpecialMaterial:SetActionItem(Index:GetID())
		LifeAbility:Lock_Packet_Item( EquipCreator_Index, 1 )
	end
end

function EquipCreator_Update()
	
	EquipCreator_Make:Disable();
	EquipCreator_SpecialMaterial:SetActionItem(-1);
	LifeAbility:Lock_Packet_Item( EquipCreator_Index, 0 );
	EquipCreator_Index = -1;
	if EquipCreator_Type == 0 then
		EquipCreator_SpecialMaterialIcon_Frame:Hide()
	else
		EquipCreator_SpecialMaterialIcon_Frame:Show()
	end
	
	EquipCreator_Item_List:ClearListBox()
	local Expand = 0;
	for i = 1, table.getn(EquipCreator_EquipList) do
		if math.mod(EquipCreator_EquipList[i][1],1000) == 0 then
			if EquipCreator_EquipList[i][2] == 0 then
				Expand = 0;
				EquipCreator_Item_List:AddItem("+ #gFE7E82"..EquipCreator_EquipList[i][3],EquipCreator_EquipList[i][1])
			elseif EquipCreator_EquipList[i][2] == 1 then
				Expand = 1;
				EquipCreator_Item_List:AddItem("- #gFE7E82"..EquipCreator_EquipList[i][3],EquipCreator_EquipList[i][1])
			end
		else
			if Expand == 1 then
				EquipCreator_Item_List:AddItem("#{_ITEM"..EquipCreator_EquipList[i][1].."}",EquipCreator_EquipList[i][1])
			end
		end
	end
	
	EquipCreator_Item:SetActionItem(-1)
	EquipCreator_Amount:SetText("")
	EquipCreator_Item_Name_Text:SetText("")

	EquipCreator_MaterialIcon1_Bk:SetActionItem(-1)
	EquipCreator_MaterialIcon2_Bk:SetActionItem(-1)
	EquipCreator_MaterialIcon3_Bk:SetActionItem(-1)
	EquipCreator_MaterialIcon4_Bk:SetActionItem(-1)
	
	EquipCreator_Material1_Name_Text:SetText("")
	EquipCreator_Material2_Name_Text:SetText("")
	EquipCreator_Material3_Name_Text:SetText("")
	EquipCreator_Material4_Name_Text:SetText("")
	
	EquipCreator_MaterialIcon1:Hide()
	EquipCreator_MaterialIcon2:Hide()
	EquipCreator_MaterialIcon3:Hide()
	EquipCreator_MaterialIcon4:Hide()
	
	EquipCreator_MaterialIcon1_Amount:SetText("")
	EquipCreator_MaterialIcon2_Amount:SetText("")
	EquipCreator_MaterialIcon3_Amount:SetText("")
	EquipCreator_MaterialIcon4_Amount:SetText("")
end

function EquipCreator_ListBox_Selected()

	local nSelIndex = EquipCreator_Item_List:GetFirstSelectItem();
	EquipCreator_Selection = nSelIndex;
	if math.mod(nSelIndex,1000) ~= 0 then
		
		--Main Item
		local Index = GemMelting:UpdateProductAction(nSelIndex);
		EquipCreator_Item:SetActionItem(Index:GetID())
		EquipCreator_Amount:SetText("")
		EquipCreator_Item_Name_Text:SetText("#{_ITEM"..nSelIndex.."}")
		
		--Material Need
		--DataPool:GetPlayerMission_ItemCountNow(EquipCreator_EquipList[i][3])
		local CanClickOK = 1;
		for i = 1, table.getn(EquipCreator_EquipList) do
			if EquipCreator_EquipList[i][1] == nSelIndex then
				if EquipCreator_Type == 0 then
					if EquipCreator_EquipList[i][3] ~= -1 then
						local Index1 = GemMelting:UpdateProductAction(EquipCreator_EquipList[i][3]);
						EquipCreator_MaterialIcon1_Bk:SetActionItem(Index1:GetID())
						
						if DataPool:GetPlayerMission_ItemCountNow(EquipCreator_EquipList[i][3]) < EquipCreator_EquipList[i][4] then
							EquipCreator_MaterialIcon1_Amount:SetText("#cFF0000"..EquipCreator_EquipList[i][4])
							EquipCreator_MaterialIcon1:Show()
							
							CanClickOK = 0;
						else
							EquipCreator_MaterialIcon1_Amount:SetText(EquipCreator_EquipList[i][4])
							EquipCreator_MaterialIcon1:Hide()
						end
						EquipCreator_Material1_Name_Text:SetText("#{_ITEM"..EquipCreator_EquipList[i][3].."}")
					end
					if EquipCreator_EquipList[i][5] ~= -1 then
						local Index2 = GemMelting:UpdateProductAction(EquipCreator_EquipList[i][5]);
						EquipCreator_MaterialIcon2_Bk:SetActionItem(Index2:GetID())
						
						if DataPool:GetPlayerMission_ItemCountNow(EquipCreator_EquipList[i][5]) < EquipCreator_EquipList[i][6] then
							EquipCreator_MaterialIcon2_Amount:SetText("#cFF0000"..EquipCreator_EquipList[i][6])
							EquipCreator_MaterialIcon2:Show()
							
							CanClickOK = 0;
						else
							EquipCreator_MaterialIcon2_Amount:SetText(EquipCreator_EquipList[i][6])
							EquipCreator_MaterialIcon2:Hide()
						end
						EquipCreator_Material2_Name_Text:SetText("#{_ITEM"..EquipCreator_EquipList[i][5].."}")
					end
					if EquipCreator_EquipList[i][7] ~= -1 then
						local Index3 = GemMelting:UpdateProductAction(EquipCreator_EquipList[i][7]);
						EquipCreator_MaterialIcon3_Bk:SetActionItem(Index3:GetID())
						
						if DataPool:GetPlayerMission_ItemCountNow(EquipCreator_EquipList[i][7]) < EquipCreator_EquipList[i][8] then
							EquipCreator_MaterialIcon3_Amount:SetText("#cFF0000"..EquipCreator_EquipList[i][8])
							EquipCreator_MaterialIcon3:Show()
							
							CanClickOK = 0;
						else
							EquipCreator_MaterialIcon3_Amount:SetText(EquipCreator_EquipList[i][8])
							EquipCreator_MaterialIcon3:Hide()
						end
						EquipCreator_Material3_Name_Text:SetText("#{_ITEM"..EquipCreator_EquipList[i][7].."}")
					end
					if EquipCreator_EquipList[i][9] ~= -1 then
						local Index4 = GemMelting:UpdateProductAction(EquipCreator_EquipList[i][9]);
						EquipCreator_MaterialIcon4_Bk:SetActionItem(Index4:GetID())
						
						if DataPool:GetPlayerMission_ItemCountNow(EquipCreator_EquipList[i][9]) < EquipCreator_EquipList[i][10] then
							EquipCreator_MaterialIcon4_Amount:SetText("#cFF0000"..EquipCreator_EquipList[i][10])
							EquipCreator_MaterialIcon4:Show()
							
							CanClickOK = 0;
						else
							EquipCreator_MaterialIcon4_Amount:SetText(EquipCreator_EquipList[i][10])
							EquipCreator_MaterialIcon4:Hide()
						end
						EquipCreator_Material4_Name_Text:SetText("#{_ITEM"..EquipCreator_EquipList[i][9].."}")
					end
					
					if CanClickOK == 1 then
						EquipCreator_Make:Enable()
					else
						EquipCreator_Make:Disable()
					end
					EquipCreator_SpecialMaterialIcon_Frame:Hide()
				else
					local DaTaoDo = EquipCreator_EquipList[i][7]
					if DaTaoDo >= 20308001 and DaTaoDo <= 20308192 then
					
					else
						DaTaoDo = EquipCreator_EquipList[i][9]
					end
					
					if DaTaoDo ~= -1 then
						local Index1 = GemMelting:UpdateProductAction(DaTaoDo);
						EquipCreator_MaterialIcon1_Bk:SetActionItem(Index1:GetID())
						
						if DataPool:GetPlayerMission_ItemCountNow(DaTaoDo) < 1 then
							EquipCreator_MaterialIcon1_Amount:SetText("#cFF00001")
							EquipCreator_MaterialIcon1:Show()
							
							CanClickOK = 0;
						else
							EquipCreator_MaterialIcon1_Amount:SetText(1)
							EquipCreator_MaterialIcon1:Hide()
						end
						EquipCreator_Material1_Name_Text:SetText("#{_ITEM"..DaTaoDo.."}")
					end
					
					if CanClickOK == 1 and EquipCreator_Index ~= -1 then
						EquipCreator_Make:Enable()
					else
						EquipCreator_Make:Disable()
					end
					EquipCreator_SpecialMaterialIcon_Frame:Show()
				end
				break
			end
		end
	else
		local Index_Clicked = 0;
		for i = 1, table.getn(EquipCreator_EquipList) do
			if nSelIndex == EquipCreator_EquipList[i][1] then
				if EquipCreator_EquipList[i][2] == 0 then
					EquipCreator_EquipList[i][2] = 1;
					Index_Clicked = i;
				else
					EquipCreator_EquipList[i][2] = 0;
				end
				break
			end
		end
		
		EquipCreator_SpecialMaterialIcon_Frame:Show()
		EquipCreator_Update();
		if Index_Clicked ~= 0 then
			EquipCreator_Item_List:SetItemSelectByItemID(EquipCreator_EquipList[Index_Clicked][4])
		end
	end
end

function EquipCreator_Clicked_OK()
	-- local Timer = EquipCreator_Timer:GetProperty("Timer")
	-- if Timer == "1" or Timer == "2" then
		-- PushDebugMessage("Vui lòng ch¶ ðþi!")
		-- return
	-- end

	if EquipCreator_Selection == -1 then
		PushDebugMessage("Hãy lña ch÷n trang b¸ c¥n chª tÕo!")
		return
	end
	
	if EquipCreator_Type == 1 then
		if EquipCreator_Index == -1 then
			PushDebugMessage("Hãy ðßa vào nguyên li®u ð£c bi®t!")
			return
		end
	end
	
	Clear_XSCRIPT()
		Set_XSCRIPT_Function_Name("OnCreateItem")
		Set_XSCRIPT_ScriptID(045050)
		Set_XSCRIPT_Parameter(0, EquipCreator_Type) 
		Set_XSCRIPT_Parameter(1, EquipCreator_Selection) 
		Set_XSCRIPT_Parameter(2, EquipCreator_Index)
		Set_XSCRIPT_ParamCount(3)
	Send_XSCRIPT()
	
	EquipCreator_ListBox_Selected()
	-- EquipCreator_Timer:SetProperty("Timer",2);
end

function EquipCreator_ClearItem()
	EquipCreator_SpecialMaterial:SetActionItem(-1)
	LifeAbility:Lock_Packet_Item( EquipCreator_Index, 0 )
	
	EquipCreator_Index = -1;
end

function EquipCreator_Help()
	PushDebugMessage("Bäng xªp hÕng c¤p ðµ!")
end

function EquipCreator_OnHidden()
	LifeAbility:Lock_Packet_Item( EquipCreator_Index, 0 )
	this:Hide()
end